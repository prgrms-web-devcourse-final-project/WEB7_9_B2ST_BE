| 기능영역 | 주요 기능 |
| --- | --- |
| 회원 및 인증 | 회원가입/로그인, 본인 인증, 마이페이지, 예매내역, 모바일티켓, 취소·환불 |
| 공연 | 공연 목록/상세 조회, 잔여석 조회 |
| 예매 시스템 | 선착순/좌석 예매, 추첨 예매, 섹션별 차등 예매 |
| 결제 | 결제 검증/승인/취소, 외부 API 연동, 미입금 자동 취소 |
| 교환·양도 | 티켓 등록, 좌석 기반 검색, 교환/양도 요청 처리 |
| 관리자 | 공연/회차/좌석 배치 관리, 예매 방식 설정, 추첨 실행 |

---

## 회원 + 마이페이지

- 회원가입 방식
    1. 소셜 로그인 - 본인인증 별도 (한가지만)
    2. 이메일로 가입하기 - 가입단계에서 본인인증 
    3. 본인 인증 API - 나이스(유료), 토스, 네이버, 카카오 셋 중 택 1
    4. 티켓 예매 시 본인 인증 필수(예매랑 연관) → 본인인증 여부를 확인하는 로직 필요
- JWT 사용 - 토큰 발급, 재발급, 인가
- 마이 페이지
    1. 내 정보 조회/수정
    2. 예매 내역 목록 조회
    3. 모바일 티켓 조회 : 실물 잃어버림 방지를 위해 모바일만 진행
        1. QR 방식 추천
    4. 공연 취소(환불) - 일정 기간 지나면 수수료 (결제 시스템 호출)
    → 취소된 표는 새벽에 랜덤 시간에 일괄적으로 풀림
- 관리자
    1. 공연 등록
        - 일정/회차/좌석 배치도/등급 등록
        - 예매 방식 설정(선착/추첨/좌석)

---

## 공연

- 공연이나 콘서트 목록 조회(검색/필터)
- 공연 정보 조회
    1. 예매 가능한 날짜/회차 조회
    2. 전체적인 좌석 등급/구역별 잔여석 조회 (추첨이어도, 취소표가 생길 수 있음)
    - 참고
        
        ![image.png](attachment:8aa09a7c-f7f2-42ac-a19b-3bc022b40cf4:image.png)
        
- 서버 시간 초시계 표기 + 오픈시 예매버튼 자동 활성화 (추가기능) : 네이비즘
1. 예매 
    - 공통
        - 일괄 취소 관련된 처리 로직 필요 → ex) 정보 모아뒀다가 배치로 일괄 처리?
    - 선착순/좌석별 예매
        1. 선택한 날짜/회차에 따른 좌석 정보 가져오기
        2. 선택된 좌석의 세부 정보 조회 (ex. S석 가격 얼마)
        3. 예매 가능한 구역인지 확인(좌석별 예매인 경우)
        4. 선택된 좌석 상태 조회 (동시성 확인)
            
            redis - 임시점유 (00분 유지 후 자동 해제(결제 취소/이탈시 즉시 해제)
            
        5. 결제 요청 (결제 시스템 호출)
        6. 결제 결과에 따른 처리 진행
        7. 예매 확정(결제 완료 후 최종 티켓 생성) → 티켓 테이블?
    - 추첨 예매 : 원하는 구역 선택 후 추첨 방식
        - 사용자 관점
            1. 선택한 날짜/회차 선택
            2. 원하는 구역 선택
            3. 인원 선택 
            4. 응모하기
            5. 당첨 확인 후 결제 진행(좌석은 랜덤 배정)
        - 시스템 관점 → 종료 후에 자동으로 추첨? 아니면 관리자가 추첨 api 호출?
            1. 응모 내역 조회
            2. 당첨자 선정 실행
            3. 당첨 결과 사용자에게 전달 (알림/홈페이지에 게시)
            4. 당첨자 확인 후 결제 진행
                - 미결제 시 기한 경과 후 자동 드랍(잔여석 처리)
                - 미결제 좌석은 재추첨 or 재응모 → 방식 확인
            5. 예매 확정

---

## 결제 (가입비 고려)

- 타 도메인에서 요청 들어오면 처리 진행
- 결제 순서
    1. 결제 사전 검증 (결제 금액 변조 방지 위해서 서버가 결제 정보 저장 한다든가)
    2. 결제 승인 검증? (PG사 연동해서 결제 구현하는 거면, 결제 성공 후 서버로 보내는 데이터 검증하고 db 반영) 
    3. 결제 로직
- 결제 취소/환불 (전체/부분 환불 로직)
    1. 미입금 자동 취소 : (배치 / 스케쥴러) << 무통 입금 기한 경과 시 주문 취소랑 좌석 릴리즈
- 재시도 / 타임아웃 / 중복결제 대비 로직

---

## 교환/양도

- 교환 시스템의 목적 : 공연을 같이 즐기기 위한 사람들을 위해
    - 연석이 중요하므로 좌석 정보가 필요함 / 완전 세부는 아니더라도 추측할 수 있게
- 티켓 등록 방법
    1. 교환, 양도 선택
        - 티켓이 있는 사람만 등록 가능
        - 마이페이지에서 현황 확인 가능
    2. 원하는 좌석을 복수로 등록 진행
    3. 내 좌석도 등록
        - 교환인 경우 - 공개
        - 양도인 경우 세부 정보는 공개되지 않음
    4. 등록 완료
        - 등록 후에 원하는 좌석이 이미 등록되어 있다면 추천으로 표기할지
- 좌석 검색 관련
    1. 대상 공연에서 원하는 좌석 선택
    2. 선택한 좌석에 해당하는 목록 리스트업
        - 티켓이 없는 사용자
            - 양도만 확인 가능(n구역 n열)
        - 티켓이 있는 사용자
            - 사용자가 ‘교환’ 등록을 한 경우
                - 교환 글 노출
                - 양도 글의 세부 좌석 확인 가능 (n구역 n열 **m석)**
            - ‘교환’ 등록을 하지 않은 경우
                - 양도글만 노출
                - 대략 적인 좌석만 확인 가능 (n구역 n열)

---

## 추가 기능 모음

- 예매 시스템 관련
    - 새로고침 없이 실시간 좌석 상태 조회 (추가)
    - 예매 대기 알림 설정 (추가)
- 공연 종류 추가
    - 전시 + 팝업 스토어 : 시간당 입장인원수만 제한 (시간대)
- reCAPCHA 인증 추가 → 문자 입력 말고 퍼즐 방식이었으면 좋겠다라는 의견이 있었음
- 티켓 다이나믹 프라이싱 (=티켓 가격 타임세일)
    
    비인기 공연의 경우 마감 시간이 오면 타임 세일 → 홍보 → 마감 시간에 따른 할인 시스템
    
- 공연별 채팅 커뮤니티 n:m
    - 채팅을 넣고 싶으면 (택시비 엔 방의) 파티원/굿즈 나눔 → 이런 모집 기능에서 활용
- 수익화 대기열 시스템 : google ADs
- 추천 큐레이션 → 난도 높을지도
    - elastic search
    - tag기반 코사인 유사도
    - 그냥 추천
- 할인 쿠폰 적용
- 관심 분야 등록 관련하여 알림 추천(공연 미리 알림 서비스)