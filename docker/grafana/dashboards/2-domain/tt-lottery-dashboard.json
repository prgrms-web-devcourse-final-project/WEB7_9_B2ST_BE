# ----- 추첨 현황 (LotteryMetrics 기반) -----

# 추첨 응모 추이
sum(rate(lottery_entry_total[
    1m
])) by (performance_id)

# 추첨 응모 수량 추이
sum(rate(lottery_entry_quantity_total[
    1m
])) by (performance_id)

# 추첨 당첨 추이
sum(rate(lottery_draw_total{result="won"
}[
    1m
])) by (performance_id)

# 추첨 낙첨 추이
sum(rate(lottery_draw_total{result="lost"
}[
    1m
])) by (performance_id)

# 추첨 당첨률
sum(rate(lottery_draw_total{result="won"
}[
    5m
])) / sum(rate(lottery_draw_total[
    5m
])) * 100

# 당첨자 결제 완료 추이
sum(rate(lottery_winner_payment_total{status="completed"
}[
    1m
])) by (performance_id)

# 당첨자 결제 만료 추이
sum(rate(lottery_winner_payment_total{status="expired"
}[
    1m
])) by (performance_id)

# 당첨자 결제 전환율
sum(rate(lottery_winner_payment_total{status="completed"
}[
    1h
])) / sum(rate(lottery_winner_payment_total[
    1h
])) * 100


# ----- Lottery API 성능 -----

# Lottery API P95 응답시간
histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket{uri=~"/api/lottery.*"
}[
    5m
])) by (le))

# Lottery API 에러율
sum(rate(http_server_requests_seconds_count{uri=~"/api/lottery.*", status=~"5.."
}[
    5m
])) / sum(rate(http_server_requests_seconds_count{uri=~"/api/lottery.*"
}[
    5m
])) * 100

# Lottery API RPS
sum(rate(http_server_requests_seconds_count{uri=~"/api/lottery.*"
}[
    1m
]))
