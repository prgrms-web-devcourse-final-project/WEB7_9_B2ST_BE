## 0. 공통 컬럼 : BaseEntity

| 항목 | 변수명(spring) | 타입 | 비고 |
| --- | --- | --- | --- |
| 생성일 | createdAt | LocalDateTime |  |
| 생성자 | createdBy | Long | 사용자 ID |
| 수정일 | modifiedAt | LocalDateTime |  |
| 수정자 | modifiedBy | Long | 사용자 ID |

## 0. 대기열

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 대기열 ID | queueId | Long | queue_id | PK |
| 사용자 ID | memberId | Long | member_id | FK |
| 공연 회차 ID | scheduleId | Long | schedule_id | FK |
| 우선순위 | queueRank | Long | queue_rank | 번호 작을수록 먼저 입장 |
| 대기열 상태 | queueStatus | Enum | queue_status | WAITING, ENTERABLE, EXPIRED 등 |
| 대기열 종료 후 입장 시간 | enterableAt | LocalDateTime | enterable_at |  |
- 결제 만료 시간(사용자가 좌석을 선택(Hold)한 후 결제를 완료해야하는 마감 시각) 관련하여, 대기열 테이블에서 관리하는지
- 회차별 좌석상태 테이블에서 수정시간을 기준으로 처리하는 방식으로 해야하는지
- .
    
    ### 대기열 전체 동작 흐름
    
    1. `ENTER` 요청 → queue_waiting 생성 → Redis 리스트 push → position 반환
    2. 서버가 주기적으로 position 업데이트 또는 Redis에서 직접 계산
    3. 순서가 되면 queue_waiting.status = PASSED로 바꾸고 queue_pass 발행
    4. PASS 토큰으로 예매 페이지 접근 허용
    5. TTL 만료 시 EXPIRED 처리
    
    1. queue_waiting (대기 중 사용자)
    
    | 컬럼명 | 타입 | 설명 |
    | --- | --- | --- |
    | id | BIGINT (PK) | 기본키 |
    | queue_token | VARCHAR(64) UNIQUE | 대기열 토큰 |
    | member_id | BIGINT (NULL 가능) | 사용자 ID (비로그인 가능) |
    | created_at | DATETIME | 대기열 진입 시간 |
    | expires_at | DATETIME | TTL (대기열 유지 만료 시간) |
    | status | ENUM('WAITING','PASSED','EXPIRED') | 현재 상태 |
    | position | INT | 대기 번호 |
    
    2. queue_pass (대기열 통과 사용자)
    
    | 컬럼명 | 타입 | 설명 |
    | --- | --- | --- |
    | id | BIGINT (PK) | 기본키 |
    | queue_token | VARCHAR(64) | 연결된 대기열 토큰 |
    | pass_token | VARCHAR(64) UNIQUE | 예매 접근용 PASS 토큰 |
    | member_id | BIGINT | 사용자 ID |
    | issued_at | DATETIME | PASS 발급 시간 |
    | expires_at | DATETIME | PASS 만료 시간 |

# 1. 회원(members)

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 고유 ID | id | Long | member_id | PK |
| 이메일 (로그인 ID) | email | String | email | Unique |
| 비밀번호 | password | String | password | 소셜 회원은 null 가능 |
| 실명 | name | String | name | 본인인증 후 업데이트 |
| 닉네임 | nickname | String | nickname | unique |
| 휴대폰 번호 | phone | String | phone |  |
| 생년월일 | birth | LocalDate | birth |  |
| 권한 | role | Enum | role | member, ADMIN |
| 로그인 제공자 | provider | Enum | provider | EMAIL, KAKAO |
| 소셜 식별자 | providerId | String | provider_id | 카카오 고유 ID(일반은 null) |
| 본인인증 여부 | isVerified | Boolean | is_verified | default는 false |
| 가입일시 | createdAt | LocalDateTime | created_at |  |
| 수정일시 | updatedAt | LocalDateTime | updated_at |  |
| 탈퇴일시 | deletedAt | LocalDateTime | deleted_at | soft delete용(null이면 활동중) |

## 1.1 환불 계좌(Refund_Accounts)

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 고유 ID | accountId | Long | account_id | PK |
| 소유자 ID | member | member | member_id | FK(members) |
| 은행명 | bankCode |  | bank_code |  |
| 계좌번호 | accountNumber | String | account_number |  |
| 예금주명 | holderName | String | holder_name |  |
- 마이페이지 조회할 때 가져와야 할 필드 메모
    
    예매tb
    
    - 예매 id
    - 예매한 사람 (member_id)
    - 공연 회차 id(있으면)
    - 예매 상태(pending, paid, cancelled?)
    - 총 결제 금액
    - 예매 일시
    
    티켓tb
    
    - 티켓 id
    - 예매 정보 (예매_id?)
    - 좌석 id
    - 발권 번호 ticker_no
    - 상태(use_before, used, cancelled?)

# 2. 공연

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 고유ID | performanceId | Long | performance_id | PK |
| 공연장 ID | venueId | Long | venue_id | FK(Venue) |
| 공연명 | title | String | title | 공연명 |
| 카테고리 | category | String | category | CONCERT / MUSICAL / CLASSIC 등 |
| 포스터 URL | posterUrl | String | poster_url | 이미지 경로 |
| 상세 설명 | description | String | description | 공연 소개 |
| 시작일 | startDate | LocalDateTime | start_date | 공연 시작 날짜 |
| 종료일 | endDate | LocalDateTime | end_date | 공연 종료 날짜 |
| 러닝타임(분) | runningTime | Integer | running_time | 러닝타임 (옵션) |
| 연령 제한 | ageLimit | String | age_limit | “만 7세 이상” 등 (옵션) |
| 상태 | status | String | status | ON_SALE, ENDED, CANCELED 등 |

## 2.1 공연장 - Venue

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 공연장 ID | venueId | Long | venue_id | PK |
| 공연장명 | name | String | name | 예: 블루스퀘어 |
| 총 좌석 수 | totalSeats | Integer | total_seats |  |

## 2.2 공연 날짜, 회차 - PerformaceScheduleId

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 회차 ID | scheduleId | Long |  | PK |
| 공연 ID | performanceId | Long | performance_id | FK |
| 공연 날짜 | startDate | Date |  | YYYY-MM-DD |
| 공연 시간 | startDate | Time |  | HH:MI:00 |
| 회차정보 | roundNo | INT | round_no | 1회차, 2회차 |
| 예매 방식 | bookingType | ENUM |  | firstcome(선착순)
seat(구역별)
lottery(추첨) |
| 추첨 마감 시간 | deadline | Datetime |  |  |
- 추첨 마감 시간 컬럼 추가 - 25.12.09
    - 예매 방식이 추첨인 경우, 마감 기한 설정이 필요함

# 3. 좌석 -Seat

- 참고
    
    ![image.png](attachment:11c9906e-a562-4480-af40-dae65890b1a7:image.png)
    
- 검색 조회 성능을 위해 `구역 ID` 를 사용할지, 아니면 `구역명`을 사용할지?

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 좌석 ID | seatId | Long | member_id | PK |
| 공연장 ID | venueId | Long | venue_id | FK (Venue) |
| 구역 ID | sectionID | Integer |  |  |
| 구역명 | sectionName | String | section_name | A구역, B구역 등 (같은 구역 안에서도 다른 등급이 있을 수 있음) |
| 열(row) | rowLabel | String | row_label | 1열, 2열 |
| 좌석 번호 | seatNumber | Integer | seat_number | 같은 열 안에서 번호 |
| 좌석 등급 | grade | String | grade | VIP / R / S / A 등(등급에 따라 가격 다름) |
- **등급/가격 테이블**을 별도로 생성
    - id/공연id/등급/가격
    1. 공연 테이블에 차등여부 Y/N 으로 Y인경우 해당 테이블을 조회
    →N인 케이스는 공연 테이블에 기본 가격을 설정해야함
        
        공연 테이블에 칼럼 2개가 추가
        차등여부(Y/N) 
        → y: 등급 가격테이블 조회 ,
        → N → 기본가격 컬럼 확인
        기본가격(price) (null)
        
    2. 아니면, 그냥 기본적으로 가격을 따로 관리하기
    →등급 : DEFAULT 인 경우 기본 가격 설정
    (공연 테이블에 가격관련된 정보가 X)

## 3.1 좌석 등급 - SeatGrade

- 등급 ENUM? String?

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 고유 ID | gradeId | Long |  | PK |
| 공연 ID | performanceId | String |  |  |
| 좌석 등급 | grade | ? |  | DEFAULT - 기본가격 |
| 가격 | price | Integer |  |  |

## 3.2 회차별 좌석 상태 - ScheduleSeat

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 회차별 좌석 ID | scheduleSeatId | Long | schedule_seat_id | PK |
| 회차 ID | scheduleId | Long | schedule_id | FK (PerformanceSchedule) |
| 좌석 ID | seatId | Long | seat_id | FK (Seat) |
| 상태 | status | String | status | AVAILABLE / HOLD / SOLD |
- 좌석 상태는 수시로 조회되어야함. → 상태가 갱신되니까
- 현재 페이지 구조상 좌석 선택시 가격 정보가 필요함. → 없다면 테이블 조인으로 가져와야함
- join과 조회 성능을 위해 어떤 칼럼을 추가로 둬야할까?

# 4. 예매

- 좌석 배치가 확정된 경우에만 등록
    - 일반 예매 선착순 결제 완료인 경우 등록
    - 추첨 당첨 된 사람이 결제까지 완료한 경우 해당 테이블에 등록

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 고유 ID | id | Long | reservation_id | 티켓번호(PK) |
| 공연 | performanceId | Long | performance_id | FK → performance |
| 예매자 | memberId | Long | member_id | FK → member |
| 좌석 | seatId | Long | seat_id | FK → seat |
| 결제여부 | isPaid | Boolean | is_paid | Y/N |
| 결제방법 | paymentMethod | String (Enum) | payment_method | 카드/무통장 |
| 예매 일시 | createdAt | LocalDateTime | created_at | now() |
| 결제 완료 시간 | paidAt | LocalDateTime | paid_at | nullable |
- 결제 완료 시간은 baseEntity의 생성일로 대체될 것 같습니다

## 4.1 추첨 응모 - LotteryEntry

- 추첨 예매 → 당첨, 미당첨, 결제 수단
- 공연일/공연시간 → 회차 테이블에서 추출
    
    
    | 공연일 |  | LocalDate |  | YYYT-MM-DD |
    | --- | --- | --- | --- | --- |
    | 공연시간 |  | LocalTime |  | HH:MI:00 |
- 구역명으로 검색하기 vs 구역 ID 별도로 사용하기
- 희망 구역? 희망 등급?

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 응모 ID | id | Long | lottery_entry_id |  |
| 응모자 | memberId | Long | member_id | 사용자 FK |
| 공연 | performanceId | Long | performance_id | 공연 FK |
| 회차 | scheduleId | Long | schedule_id | 공연상세 FK |
| 희망 등급 | grade | Long | section_id | 좌석 FK |
| 인원 | quantity | Integer | quantity |  |
| 결과 | status | ENUM | status | applied(응모)
selected(당첨)
not_selected(미당첨) |
| 결제방법 | paymentMethod |  |  | 카드/무통장 |

## 4.2 추첨 결과 - LotteryResult

- 좌석 배정

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 당첨 ID | id | Long | lottery_result_id |  |
| 응모 ID | lotteryEntryId | Long | lottery_entry_id | 공연 FK |
| 좌석 ID | seatId | Long |  | 좌석 FK |
| 결제기한 | paymentDeadline | LowDateTime | payment_deadline |  |
| 결제완료여부 | paid | Boolean | is_paid | Y/N |
- 추첨 결제 완료 시 티켓 생성

# 5. 티켓

- 보유 티켓 확인하기 → 모바일 qr :: MVP 말고
- 조회를 위한 좌석 정보 포함 여부?
- 그러면 티켓 공연상세/좌석 조회를 위해 예매 테이블과 join? 아니면 필요한 컬럼을 테이블에 포함?

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 티켓 ID | id | Long |  |  |
| 예매 | reservation_id  | Long |  | FK |
| 소유자 | member_id | Long |  | FK |
| QR 토큰 | qr_code | String |  | QR 토큰 |
| 상태 | status | ENUM |  | valid(승인)
canceled(취소)
transferred(교환) |
| 좌석 ID | seatId | Long |  | 좌석 FK |

# 6. 결제

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 고유 ID | id | Long  | payment_id |  |
| 예매 ID | reservationId  | Long  | reservation_id |  |
| 사용자 ID | memberId | Long  | member_id |  |
| 결제 금액 | amount | int | amount |  |
| 결제 수단       | method | varchar | method |  |
| 결제 완료 시간 | paidAt | datetime | paid_at |  |
| 결제 상태 | status | varchar | status |  |

# 7. 교환/양도 - trade

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 고유 ID | id | Long | trade_id | PK |
| 등록자(판매자/교환자) 사용자 ID | memberId | Long | member_id | FK → 회원 |
| 공연 ID | performanceId |  | performance_id | FK → 공연 |
| 회차 ID | scheduleId  |  | schedule_id  |  |
| 거래 유형 | type | String | type | (EXCHANGE/TRANSFER) |
|  | status |  | status | ACTIVE/COMPLETED/CANCELLED |
| 가격 | price | Integer | price | 양도만 |
| 총 티켓 수 | totalCount | String | total_count | 양도할 티켓수 |
| 생성일 | createdAt | LocalDateTime | created_at |  |
| 수정일 | updateAt | LocalDateTime | updated_at |  |

## 7.1 trade_request 교환 신청 (교환만 사용)

| 항목 | 변수명(spring) | 타입 | DB 칼럼명 | 비고 |
| --- | --- | --- | --- | --- |
| 고유 ID | tradeTicketId | Long | trade_request_id  | PK |
| 게시글 ID | tradeId | long | trade_id | FK → Trade |
| 신청자 ID |  requesterId     | long | requester_id    |  |
| 신청자 티켓 ID | requesterTicketId    | Long               | requester_ticket_id  |  |
| 요청 상태 |  status | String |  status | PENDING/ACCEPTED/REJECTED |