# ----- 로그인 메트릭 -----

# 로그인 성공 추이
sum(rate(auth_login_total{result="success"}[1m]))

# 로그인 실패 추이
sum(rate(auth_login_total{result="failure"}[1m]))

# 로그인 성공률 (%)
sum(rate(auth_login_total{result="success"}[5m])) / sum(rate(auth_login_total[5m])) * 100

# Provider별 로그인 (EMAIL)
sum(rate(auth_login_total{provider="EMAIL"}[1m])) by (result)

# Provider별 로그인 (KAKAO)
sum(rate(auth_login_total{provider="KAKAO"}[1m])) by (result)

# 로그인 실패 사유별 분포
sum(rate(auth_login_failure_reason_total[5m])) by (reason)


# ----- 계정 보안 -----

# 현재 잠긴 계정 수
auth_locked_account_count

# 계정 잠금 발생 추이
sum(rate(auth_account_locked_total[5m]))

# 계정 잠금 24시간 누적
sum(increase(auth_account_locked_total[24h]))


# ----- 보안 위협 -----

# 보안 위협 탐지 (유형별)
sum(rate(security_threat_detected_total[5m])) by (type)

# 보안 위협 탐지 (심각도별)
sum(rate(security_threat_detected_total[5m])) by (severity)

# Rate Limit 트리거 (엔드포인트별)
sum(rate(security_rate_limit_triggered_total[5m])) by (endpoint)

# 24시간 보안 위협 누적
sum(increase(security_threat_detected_total[24h])) by (type)


# ----- 토큰 관리 -----

# 토큰 재발급 추이
sum(rate(auth_token_reissue_total[5m]))

# 로그아웃 추이
sum(rate(auth_logout_total[5m]))


# ----- Auth API 성능 -----

# Auth API P95 응답시간
histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket{uri=~"/api/auth.*"}[5m])) by (le))

# Auth API 에러율
sum(rate(http_server_requests_seconds_count{uri=~"/api/auth.*", status=~"5.."}[5m])) / sum(rate(http_server_requests_seconds_count{uri=~"/api/auth.*"}[5m])) * 100

# Auth API RPS
sum(rate(http_server_requests_seconds_count{uri=~"/api/auth.*"}[1m]))
